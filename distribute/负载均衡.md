> 转载： http://www.cnblogs.com/kevingrace/p/6137881.html

# linux负载均衡总结性说明（四层负载/七层负载）

## 一，什么是负载均衡
1. ***`负载均衡（Load Balance）`*** 建立在现有网络结构之上，它提供了一种廉价有效透明的方法扩展网络设备和服务器的带宽、增加吞吐量、加强网络数据处理能力、提高网络的灵活性和可用性。负载均衡有两方面的含义：首先，大量的并发访问或数据流量分担到多台节点设备上分别处理，减少用户等待响应的时间；其次，单个重负载的运算分担到多台节点设备上做并行处理，每个节点设备处理结束后，将结果汇总，返回给用户，系统处理能力得到大幅度提高。
2. 简单来说就是：其一是将大量的并发处理转发给后端多个节点处理，减少工作响应时间；其二是将单个繁重的工作转发给后端多个节点处理，处理完再返回给负载均衡中心，再返回给用户。目前负载均衡技术大多数是用于提高诸如在Web服务器、FTP服务器和其它关键任务服务器上的Internet服务器程序的可用性和可伸缩性。


## 二，负载均衡分类
1. 二层负载均衡（mac）
根据OSI模型分的二层负载，一般是用虚拟mac地址方式，外部对虚拟MAC地址请求，负载均衡接收后分配后端实际的MAC地址响应）
2. 三层负载均衡（ip）
一般采用虚拟IP地址方式，外部对虚拟的ip地址请求，负载均衡接收后分配后端实际的IP地址响应）
3. 四层负载均衡（tcp）
在三次负载均衡的基础上，用ip+port接收请求，再转发到对应的机器。
4. 七层负载均衡（http）
根据虚拟的url或IP，主机名接收请求，再转向相应的处理服务器。

### 我们运维中最常见的四层和七层负载均衡，这里重点说下这两种负载均衡。
- 1）`四层的负载均衡`就是基于IP+端口的负载均衡：在三层负载均衡的基础上，通过发布三层的IP地址（VIP），然后加四层的端口号，来决定哪些流量需要做负载均衡，对需要处理的流量进行NAT处理，转发至后台服务器，并记录下这个TCP或者UDP的流量是由哪台服务器处理的，后续这个连接的所有流量都同样转发到同一台服务器处理。
对应的负载均衡器称为四层交换机（L4 switch），主要分析IP层及TCP/UDP层，实现四层负载均衡。此种负载均衡器不理解应用协议（如HTTP/FTP/MySQL等等）。
***实现四层负载均衡的软件有：***
1. F5：硬件负载均衡器，功能很好，但是成本很高。
2. lvs：重量级的四层负载软件
3. nginx：轻量级的四层负载软件，带缓存功能，正则表达式较灵活
4. haproxy：模拟四层转发，较灵活
- 2）`七层的负载均衡`就是基于虚拟的URL或主机IP的负载均衡：在四层负载均衡的基础上（没有四层是绝对不可能有七层的），再考虑应用层的特征，比如同一个Web服务器的负载均衡，除了根据VIP加80端口辨别是否需要处理的流量，还可根据七层的URL、浏览器类别、语言来决定是否要进行负载均衡。举个例子，如果你的Web服务器分成两组，一组是中文语言的，一组是英文语言的，那么七层负载均衡就可以当用户来访问你的域名时，自动辨别用户语言，然后选择对应的语言服务器组进行负载均衡处理。
对应的负载均衡器称为七层交换机（L7 switch），除了支持四层负载均衡以外，还有分析应用层的信息，如HTTP协议URI或Cookie信息，实现七层负载均衡。此种负载均衡器能理解应用协议。
***实现七层负载均衡的软件有：***
1. haproxy：天生负载均衡技能，全面支持七层代理，会话保持，标记，路径转移；
2. nginx：只在http协议和mail协议上功能比较好，性能与haproxy差不多；
3. apache：功能较差
4. Mysql proxy：功能尚可。

> 总的来说，一般是lvs做4层负载；nginx做7层负载；haproxy比较灵活，4层和7层负载均衡都能做
